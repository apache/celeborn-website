
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/logo/celeborn-2.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>ShuffleClient - Apache Celeborn™</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shuffleclient" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Apache Celeborn™" class="md-header__button md-logo" aria-label="Apache Celeborn™" data-md-component="logo">
      
  <img src="../../assets/logo/celeborn-1.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apache Celeborn™
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ShuffleClient
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://gitbox.apache.org/repos/asf/celeborn.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    apache/celeborn
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      QuickStart
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../deploy/" class="md-tabs__link">
        Deployment
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../configuration/" class="md-tabs__link">
      Configuration
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../migration/" class="md-tabs__link">
      Migration Guide
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../overview/" class="md-tabs__link md-tabs__link--active">
        Developers Doc
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Apache Celeborn™" class="md-nav__button md-logo" aria-label="Apache Celeborn™" data-md-component="logo">
      
  <img src="../../assets/logo/celeborn-1.svg" alt="logo">

    </a>
    Apache Celeborn™
  </label>
  
    <div class="md-nav__source">
      <a href="https://gitbox.apache.org/repos/asf/celeborn.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    apache/celeborn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        QuickStart
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy_on_k8s/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quota_management/" class="md-nav__link">
        Quota Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrading/" class="md-nav__link">
        Upgrading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../celeborn_ratis_shell/" class="md-nav__link">
        Ratis Shell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster_planning/" class="md-nav__link">
        Cluster Planning
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../migration/" class="md-nav__link">
        Migration Guide
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Developers Doc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers Doc" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Developers Doc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Master
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Master" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Master
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../master/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../slotsallocation/" class="md-nav__link">
        Slots Allocation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Worker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Worker" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Worker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../worker/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trafficcontrol/" class="md-nav__link">
        Traffic Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jvmprofiler/" class="md-nav__link">
        JVM Profiler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Client" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lifecyclemanager/" class="md-nav__link">
        LifecycleManager
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ShuffleClient
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ShuffleClient
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-data" class="md-nav__link">
    Push Data
  </a>
  
    <nav class="md-nav" aria-label="Push Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-specification" class="md-nav__link">
    API specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-shuffle-register" class="md-nav__link">
    Lazy Shuffle Register
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normal-push" class="md-nav__link">
    Normal Push
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-or-merge" class="md-nav__link">
    Push or Merge?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-push" class="md-nav__link">
    Async Push
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split" class="md-nav__link">
    Split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-data" class="md-nav__link">
    Read Data
  </a>
  
    <nav class="md-nav" aria-label="Read Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-specification_1" class="md-nav__link">
    API specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-partitionlocations" class="md-nav__link">
    Get PartitionLocations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-from-partitionlocation" class="md-nav__link">
    Read from PartitionLocation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-from-map-range" class="md-nav__link">
    Read from Map Range
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faulttolerant/" class="md-nav__link">
        Fault Tolerant
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workerexclusion/" class="md-nav__link">
        Worker Exclusion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrate/" class="md-nav__link">
        Integrating Celeborn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sbt/" class="md-nav__link">
        SBT Build
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../glutensupport/" class="md-nav__link">
        Gluten Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../helm-charts/" class="md-nav__link">
        Helm Charts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-data" class="md-nav__link">
    Push Data
  </a>
  
    <nav class="md-nav" aria-label="Push Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-specification" class="md-nav__link">
    API specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-shuffle-register" class="md-nav__link">
    Lazy Shuffle Register
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normal-push" class="md-nav__link">
    Normal Push
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-or-merge" class="md-nav__link">
    Push or Merge?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-push" class="md-nav__link">
    Async Push
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split" class="md-nav__link">
    Split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-data" class="md-nav__link">
    Read Data
  </a>
  
    <nav class="md-nav" aria-label="Read Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-specification_1" class="md-nav__link">
    API specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-partitionlocations" class="md-nav__link">
    Get PartitionLocations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-from-partitionlocation" class="md-nav__link">
    Read from PartitionLocation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-from-map-range" class="md-nav__link">
    Read from Map Range
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="shuffleclient">ShuffleClient</h1>
<h2 id="overview">Overview</h2>
<p>ShuffleClient is responsible for pushing and reading shuffle data. It's a singleton in each leaf process,
i.e. Executor in Apache Spark, or TaskManager in Apache Flink. This article describes the detailed design for
push data and read data.</p>
<h2 id="push-data">Push Data</h2>
<h3 id="api-specification">API specification</h3>
<p>The push data API is as follows:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">pushData</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">shuffleId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">mapId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">attemptId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">partitionId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">numMappers</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">numPartitions</span><span class="p">)</span><span class="w"></span>
</code></pre></div></p>
<ul>
<li><code>shuffleId</code> is the unique shuffle id of the application</li>
<li><code>mapId</code> is the map id of the shuffle</li>
<li><code>attemptId</code> is the attempt id of the map task, i.e. speculative task or task rerun for Apache Spark</li>
<li><code>partitionId</code> is the partition id the data belongs to</li>
<li><code>data</code>,<code>offset</code>,<code>length</code> specifies the bytes to be pushed</li>
<li><code>numMappers</code> is the number map tasks in the shuffle</li>
<li><code>numPartitions</code> is the number of partitions in the shuffle</li>
</ul>
<h3 id="lazy-shuffle-register">Lazy Shuffle Register</h3>
<p>The first time <code>pushData</code> is called, Client will check whether the shuffle id has been registered. If not,
it sends <code>RegisterShuffle</code> to <code>LifecycleManager</code>, <code>LifecycleManager</code> then sends <code>RequestSlots</code> to <code>Master</code>.
<code>RequestSlots</code> specifies how many <code>PartitionLocation</code>s this shuffle requires, each <code>PartitionLocation</code> logically
responds to data of some partition id.</p>
<p>Upon receiving <code>RequestSlots</code>, <code>Master</code> allocates slots for the shuffle among <code>Worker</code>s. If replication is turned on,
<code>Master</code> allocates a pair of <code>Worker</code>s for each <code>PartitionLocation</code> to store two replicas for each <code>PartitionLocation</code>.
The detailed allocation strategy can be found in <a href="../../developers/master#slots-allocation">Slots Allocation</a>. <code>Master</code> then
responds to <code>LifecycleManager</code> with the allocated <code>PartitionLocation</code>s.</p>
<p><code>LifcycleManager</code> caches the <code>PartitionLocation</code>s for the shuffle and responds to each <code>RegisterShuffle</code> RPCs from
<code>ShuffleClient</code>s.</p>
<h3 id="normal-push">Normal Push</h3>
<p>In normal cases, the process of pushing data is as follows:</p>
<ul>
<li><code>ShuffleClient</code> compresses data, currently supports <code>zstd</code> and <code>lz4</code></li>
<li><code>ShuffleClient</code> adds Header for the data: <code>mapId</code>, <code>attemptId</code>, <code>batchId</code> and <code>size</code>. The <code>bastchId</code> is a unique
  id for the data batch inside the (<code>mapId</code>, <code>attemptId</code>), for the purpose of de-duplication</li>
<li><code>ShuffleClient</code> sends <code>PushData</code> to the <code>Worker</code> on which the current <code>PartitionLocation</code> is allocated, and holds push
  state for this pushing</li>
<li><code>Worker</code> receives the data, do replication if needed, then responds success ACK to <code>ShuffleClient</code>. For more details
  about how data is replicated and stored in <code>Worker</code>s, please refer to <a href="../../developers/worker">Worker</a></li>
<li>Upon receiving success ACK from <code>Worker</code>, <code>ShuffleClient</code> considers success for this pushing and modifies the push state</li>
</ul>
<h3 id="push-or-merge">Push or Merge?</h3>
<p>If the size of data to be pushed is small, say hundreds of bytes, it will be very inefficient to send to the wire.
So <code>ShuffleClient</code> offers another API: <code>mergeData</code> to batch data locally before sending to <code>Worker</code>.</p>
<p><code>mergeData</code> merges data with the same target into <code>DataBatches</code>. <code>Same target</code> means the destination for both the
primary and replica are the same. When the size of a <code>DataBatches</code> exceeds a threshold (defaults to<code>64KiB</code>),
<code>ShuffleClient</code> triggers pushing and sends <code>PushMergedData</code> to the destination.</p>
<p>Upon receiving <code>PushMergedData</code>, <code>Worker</code> unpacks it into data segments each for a specific <code>PartitionLocation</code>, then
stores them accordingly.</p>
<h3 id="async-push">Async Push</h3>
<p>Celeborn's <code>ShuffleClient</code> does not block compute engine's execution by asynchronous pushing, implemented in
<code>DataPusher</code>.</p>
<p>Whenever compute engine decides to push data, it calls <code>DataPusher#addTask</code>, <code>DataPusher</code> creates a <code>PushTask</code> which
contains the data, and added the <code>PushTask</code> in a non-blocking queue. <code>DataPusher</code> continuously poll the queue
and invokes <code>ShuffleClient#pushData</code> to do actual push.</p>
<h3 id="split">Split</h3>
<p>As mentioned before, Celeborn will split a <code>PartitionLocation</code> when any of the following conditions happens:</p>
<ul>
<li><code>PartitionLocation</code> file exceeds threshold (defaults to 1GiB)</li>
<li>Usable space of local disk is less than threshold (defaults to 5GiB)</li>
<li><code>Worker</code> is in <code>Graceful Shutdown</code> state</li>
<li>Push data fails</li>
</ul>
<p>For the first three cases, <code>Worker</code> informs <code>ShuffleClient</code> that it should trigger split; for the last case,
<code>ShuffleClient</code> triggers split itself.</p>
<p>There are two kinds of Split:</p>
<ul>
<li><code>HARD_SPLIT</code>, meaning old <code>PartitionLocation</code> epoch refuses to accept any data, and future data of the
  <code>PartitionLocation</code> will only be pushed after new <code>PartitionLocation</code> epoch is ready</li>
<li><code>SOFT_SPLIT</code>, meaning old <code>PartitionLocation</code> epoch continues to accept data, when new epoch is ready, <code>ShuffleClient</code>
  switches to the new location transparently</li>
</ul>
<p>The process of <code>SOFT_SPLIT</code> is as follows:</p>
<p><img alt="softsplit" src="../../assets/img/softsplit.svg" /></p>
<p><code>LifecycleManager</code> keeps the split information and tells reducer to read from all splits of the <code>PartitionLocation</code>
to guarantee no data is lost.</p>
<h2 id="read-data">Read Data</h2>
<h3 id="api-specification_1">API specification</h3>
<p><code>ShuffleClient</code> provides an API that creates an InputStream to read data from a partition id. Users can also set
<code>startMapIndex</code> and <code>endMapIndex</code> to read data within the map range.
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="n">CelebornInputStream</span><span class="w"> </span><span class="nf">readPartition</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">shuffleId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">appShuffleId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">partitionId</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">attemptNumber</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">startMapIndex</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">endMapIndex</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">ExceptionMaker</span><span class="w"> </span><span class="n">exceptionMaker</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">MetricsCallback</span><span class="w"> </span><span class="n">metricsCallback</span><span class="p">)</span><span class="w"></span>
</code></pre></div></p>
<ul>
<li><code>shuffleId</code> is the unique shuffle id of Celeborn</li>
<li><code>appShuffleId</code> is the unique shuffle id of the application</li>
<li><code>partitionId</code> is the partition id to read from</li>
<li><code>attemptNumber</code> is the attempt id of reduce task, can be safely set to any value</li>
<li><code>startMapIndex</code> is the index of start map index of interested map range, set to 0 if you want to read all
  partition data</li>
<li><code>endMapIndex</code> is the index of end map index of interested map range, set to <code>Integer.MAX_VALUE</code> if you want
  to read all partition data</li>
<li><code>exceptionMaker</code> is the marker of exception including fetch failure exception.</li>
<li><code>metricsCallback</code> is the callback of monitoring metrics to increase read bytes and time etc.</li>
</ul>
<p>The returned input stream is guaranteed to be <code>Exactly Once</code>, meaning no data lost and no duplicated reading, or else
an exception will be thrown, see <a href="../../developers/faulttolerant#exactly-once">Here</a>.</p>
<h3 id="get-partitionlocations">Get PartitionLocations</h3>
<p>To read data from a partition id, <code>ShuffleClient</code> first checks whether the mapping from partition id to all
<code>PartitionLocation</code>s are locally cached, if not, <code>ShuffleClient</code> sends GetReducerFileGroup to <code>LifecycleManager</code>
for the mapping, see <a href="../../developers/lifecyclemanager#getreducerfilegroup">Here</a>.</p>
<h3 id="read-from-partitionlocation">Read from PartitionLocation</h3>
<p><code>ShuffleClient</code> creates a <code>PartitionReader</code> for each <code>PartitinLocation</code>.
As described <a href="../../developers/storage#multi-layered-storage">Here</a>, <code>PartitionLocation</code> data can be stored in
different medium, i.e. memory, local disk, distributed filesystem. For the former two, it creates
a <code>WorkerPartitionReader</code> to read from <code>Worker</code>, for the last one, it creates a <code>DfsPartitionReader</code> to read
directly from the distributed filesystem.</p>
<p>As described <a href="../../developers/storage#reducepartition">Here</a>, the file is chunked. <code>WorkerPartitionReader</code> asynchronously
requests multiple chunks from <code>Worker</code>, and reduce task consumes the data whenever available.</p>
<p>If exception occurs when fetching a chunk, <code>ShuffleClient</code> will restart reading from the beginning of another
(if replication is turned on, else retry the same) <code>PartitionLocation</code>. The reason to restart reading the whole
<code>PartitionLocation</code> instead of the chunk is because chunks with the same index in primary and replica are not
guaranteed to contain the same data, as explained <a href="../../developers/storage#reducepartition">Here</a>.</p>
<p><code>ShuffleClient</code> chained the <code>PartitionReader</code>s and wrap them in an InputStream. To avoid duplicated read,
<code>CelebornInputStream</code> discards data from un-successful attempts, and records batch ids it has seen within an attempt.</p>
<h3 id="read-from-map-range">Read from Map Range</h3>
<p>If user specifies <code>startMapIndex</code> and <code>endMapIndex</code>, <code>CelebornInputStream</code> will only return data within the range.
Under the hood is that <code>Worker</code> only responds data within the range. This is achieved by sorting and indexing the file
by map id upon receiving such range read request, then return the continuous data range of interest.</p>
<p>Notice that the sort on read is only triggered upon map range read, not for the common cases where whole partition data
is requested.</p>
<p>Celeborn also optionally records map ids for each <code>PartitionLocation</code>, in the case of map range reading,
<code>CelebornInputStream</code> will filter out <code>PartitionLocation</code>s that are out of the specified range.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../lifecyclemanager/" class="md-footer__link md-footer__link--prev" aria-label="Previous: LifecycleManager" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              LifecycleManager
            </div>
          </div>
        </a>
      
      
        
        <a href="../configuration/" class="md-footer__link md-footer__link--next" aria-label="Next: Configuration" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Configuration
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <br> Copyright © 2022-2024 The Apache Software Foundation, Licensed under the Apache License, Version 2.0. <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy<a/><br> <br> Apache Celeborn™, Apache, and the Apache feather logo are trademarks or registered trademarks of The Apache Software Foundation.<br> <br> Please visit <a href="https://www.apache.org/">Apache Software Foundation</a> for more details.<br> <br>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>